syntax = "proto3";

package spiredb.pd;

// Placement Driver metadata service
// Provides region routing information for SpireSQL
service PlacementDriver {
  // Get all regions for a table
  rpc GetTableRegions(GetTableRegionsRequest) returns (GetTableRegionsResponse);
  
  // Get region for a specific key
  rpc GetRegion(GetRegionRequest) returns (Region);
  
  // Register a store node (existing)
  rpc RegisterStore(RegisterStoreRequest) returns (RegisterStoreResponse);
  
  // Heartbeat (existing)
  rpc Heartbeat(HeartbeatRequest) returns (HeartbeatResponse);
}

// Get all regions for a table
message GetTableRegionsRequest {
  string table_name = 1;  // e.g., "users" (future use)
}

message GetTableRegionsResponse {
  repeated Region regions = 1;
}

// Get region for a specific key
message GetRegionRequest {
  bytes key = 1;
}

// Region metadata
message Region {
  uint32 region_id = 1;
  bytes start_key = 2;
  bytes end_key = 3;
  string leader_node = 4;       // e.g., "store-0.spiredb:50051"
  repeated string followers = 5;
  RegionState state = 6;
}

enum RegionState {
  REGION_STATE_UNSPECIFIED = 0;
  REGION_STATE_ACTIVE = 1;
  REGION_STATE_SPLITTING = 2;
  REGION_STATE_MERGING = 3;
}

// Store registration (existing)
message RegisterStoreRequest {
  string node_name = 1;
}

message RegisterStoreResponse {
  bool success = 1;
}

// Heartbeat (existing)
message HeartbeatRequest {
  string node_name = 1;
}

message HeartbeatResponse {
  bool success = 1;
}
